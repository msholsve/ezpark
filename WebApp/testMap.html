<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
	<title>Mazemap JavaScript API example</title>

	<link rel="stylesheet" href='http://api.mazemap.com/js/v1.0.0/mazemap.min.css'>
	<script type='text/javascript' src='http://api.mazemap.com/js/v1.0.0/mazemap.min.js'></script>
	

	<style>

		body {
			margin: 0;
		}

		#mazemap-container {
			width: 100vw;
			height: 100vh;
		}
	</style>

</head>
<body>

	<div id='mazemap-container'></div>

	<script>

		var mazeMap = Maze.map('mazemap-container', {});  
		mazeMap.setView([63.415, 10.41], 14);

		var m1 = addRoomMarker(mazeMap, [63.415, 10.41], 0.2, "http://vg.no");
		var m2 = addRoomMarker(mazeMap, [63.415, 10.40], 0.8, "http://db.no");
		var m3 = addRoomMarker(mazeMap, [63.417, 10.40], 0.33, "http://ap.no");
		
		//mazeMap.fitBounds(Maze.latLngBounds(m1.getLatLng(), m2.getLatLng(), m3.getLatLng()));
		
		
		function addRoomMarker(theMap, latLng, freeFraction, roomUrl) {
			var newMarker = Maze.marker(
				latLng, {icon: Maze.icon({iconUrl: getPieChartUrl(freeFraction), iconSize: [40, 40]})}
			);
			
			newMarker.on("click", function() {
				window.open(roomUrl, "_blank");
			});
			newMarker.addTo(theMap);
			return newMarker;
		}
		
		function getPieChartUrl(freeFraction) {
			var canvas = document.createElement('canvas');
			canvas.width = 64;
			canvas.height = 64;
			var ctx = canvas.getContext("2d");		
			ctx.beginPath();
			ctx.fillStyle="lightgreen";
			ctx.arc(32, 32, 32, -Math.PI/2, (Math.PI*2)*freeFraction - Math.PI/2);
			ctx.lineTo(32, 32); 
			ctx.fill();
			if(freeFraction < 1.0) {
				ctx.beginPath();
				ctx.fillStyle="red";
				ctx.arc(32, 32, 32, (Math.PI*2)*freeFraction - Math.PI/2, -Math.PI/2);
				ctx.lineTo(32, 32); 
				ctx.fill();
			}
			return canvas.toDataURL("image/png");
		}
	</script>


</body>
</html>
